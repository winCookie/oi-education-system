# 博客系统功能说明

> **版本**：V1.1.0  
> **部署时间**：2026年1月26日  
> **状态**：已上线

---

## 系统概述

OI教学系统新增完整的博客功能，支持用户创作、分享和交流。包含文章发布、审核、评论、点赞、收藏等完整功能。

---

## 核心功能

### 1. 文章创作与管理

#### 用户端
- **Markdown编辑器**：左右分屏实时预览
- **文章限制**：
  - 标题最多100字符
  - 内容最多5000字符
- **文章分类**：选择预设分类
- **文章标签**：最多添加5个标签
- **自动保存**：每30秒自动保存草稿
- **草稿管理**：可多次编辑后再提交

#### 发布流程
- **学生**：创建 → 草稿 → 提交审核 → 等待管理员审核 → 发布/拒绝
- **教师**：创建 → 草稿 → 直接发布（带教师标识）
- **管理员**：创建 → 草稿 → 直接发布（带官方标识）

#### 文章状态
- **草稿（draft）**：未提交，可编辑
- **待审核（pending）**：学生提交，等待管理员审核
- **已发布（published）**：审核通过或直接发布
- **已拒绝（rejected）**：审核未通过，显示拒绝原因
- **已下架（archived）**：管理员下架

### 2. 文章浏览

#### 博客首页
- **文章列表**：卡片式展示
- **分类筛选**：按分类快速筛选
- **搜索功能**：按标题搜索文章
- **热门文章**：侧边栏显示TOP 5热门文章
- **分页展示**：每页12篇文章

#### 文章展示
- **官方标识**：管理员文章显示"官方"徽章（红色）
- **教师标识**：教师文章显示"教师"徽章（绿色）
- **分类标签**：显示文章分类
- **统计数据**：阅读量、点赞量、评论量
- **发布时间**：文章发布日期
- **作者信息**：作者昵称或用户名

### 3. 文章详情

#### 内容展示
- **Markdown渲染**：支持GFM（GitHub Flavored Markdown）
- **代码高亮**：支持C++、Python等多种语言
- **响应式设计**：移动端自适应

#### 互动功能
- **点赞**：需登录，可取消点赞
- **收藏**：需登录，收藏到个人收藏夹
- **分享**：一键复制文章链接
- **评论**：需登录，支持两级评论（评论+回复）

### 4. 评论系统

#### 评论功能
- **纯文本**：不支持Markdown，只支持纯文本
- **Emoji表情**：支持emoji表情输入
- **两级评论**：
  - 一级：直接评论文章
  - 二级：回复某个评论
- **评论排序**：按时间倒序

#### 评论权限
- **发表评论**：需要登录
- **删除评论**：作者本人或管理员可删除
- **评论通知**：文章作者收到评论通知

### 5. 审核管理（管理员）

#### 待审核列表
- 显示所有待审核文章
- 显示作者、提交时间
- 文章预览

#### 审核操作
- **通过审核**：文章发布，通知作者
- **拒绝审核**：输入拒绝原因，通知作者

#### 通知推送
- **审核通过**：站内通知"您的文章《XXX》已通过审核并发布。"
- **审核拒绝**：站内通知"您的文章《XXX》未通过审核。原因：XXX"
- **收到评论**：站内通知"有人评论了您的文章《XXX》"

### 6. 分类管理（管理员）

#### 分类功能
- **创建分类**：添加新分类
- **编辑分类**：修改分类名称和描述
- **删除分类**：删除分类（需确认）
- **排序调整**：调整分类显示顺序

#### 预设分类
- 学习笔记 📚
- 解题思路 💡
- 经验分享 🎓
- 竞赛动态 🏆
- 技术教程 🔧

### 7. 标签系统

#### 标签功能
- **自动创建**：用户输入标签时自动创建
- **使用统计**：记录标签使用次数
- **标签限制**：每篇文章最多5个标签

### 8. 用户系统扩展

#### 新增字段
- **avatar**：用户头像URL
- **nickname**：用户昵称（为空时显示用户名）
- **bio**：个人简介

#### 几何头像
- 基于用户名自动生成彩色几何图形头像
- 每个用户有唯一的颜色和形状组合

---

## 页面导航

### 用户端
- `/blog` - 博客首页（文章列表）
- `/blog/:id` - 文章详情页
- `/blog/editor` - 创建新文章
- `/blog/editor/:id` - 编辑文章
- `/blog/my` - 我的文章管理

### 管理员端
- `/blog/review` - 文章审核页面
- `/blog/manage` - 分类标签管理

---

## API接口

### 文章管理
```
POST   /blog/posts              - 创建文章
PUT    /blog/posts/:id          - 更新文章
DELETE /blog/posts/:id          - 删除文章
POST   /blog/posts/:id/submit   - 提交审核/发布
GET    /blog/posts/my           - 我的文章
```

### 审核管理
```
GET    /blog/posts/pending      - 待审核文章（管理员）
POST   /blog/posts/:id/approve  - 批准文章（管理员）
POST   /blog/posts/:id/reject   - 拒绝文章（管理员）
```

### 文章查询
```
GET    /blog/posts              - 文章列表（分页、筛选、搜索）
GET    /blog/posts/:id          - 文章详情
GET    /blog/posts/:id/related  - 相关推荐
GET    /blog/posts/hot/list     - 热门文章
```

### 互动功能
```
POST   /blog/posts/:id/like     - 点赞/取消点赞
POST   /blog/posts/:id/favorite - 收藏
GET    /blog/posts/:id/comments - 获取评论
POST   /blog/posts/:id/comments - 添加评论
POST   /blog/comments/:id/like  - 点赞评论
DELETE /blog/comments/:id       - 删除评论
```

### 分类标签
```
GET    /blog/categories         - 获取分类
GET    /blog/tags               - 获取标签
POST   /blog/categories         - 创建分类（管理员）
PUT    /blog/categories/:id     - 更新分类（管理员）
DELETE /blog/categories/:id     - 删除分类（管理员）
```

---

## 数据库设计

### 新增数据表

#### blog_posts（博客文章表）
- 文章基本信息（标题、内容、摘要）
- 作者信息
- 分类和标签关联
- 文章状态（草稿/待审核/已发布/已拒绝/已下架）
- 标识（官方/教师）
- 置顶和推荐
- 统计数据（阅读量、点赞量、评论量、收藏量）
- 审核信息（审核人、审核时间、拒绝原因）

#### blog_categories（分类表）
- 分类名称
- 分类描述
- 分类图标
- 排序

#### blog_tags（标签表）
- 标签名称
- 使用次数

#### blog_comments（评论表）
- 评论内容
- 作者
- 关联文章
- 父评论（支持两级）
- 点赞数
- 软删除标记

#### blog_likes（点赞表）
- 用户ID
- 文章ID
- 点赞时间

#### blog_favorites（收藏表）
- 用户ID
- 文章ID
- 收藏笔记
- 收藏时间

---

## 技术实现

### 后端技术
- **NestJS** - 模块化架构
- **TypeORM** - 数据库ORM
- **class-validator** - 数据验证
- **NotificationsService** - 通知推送

### 前端技术
- **@uiw/react-md-editor** - Markdown编辑器（实时预览）
- **react-markdown** - Markdown渲染
- **remark-gfm** - GFM支持
- **react-syntax-highlighter** - 代码高亮
- **emoji-picker-react** - Emoji选择器

---

## 权限控制

| 功能 | 学生 | 教师 | 管理员 | 访客 |
|------|------|------|--------|------|
| 浏览文章 | ✅ | ✅ | ✅ | ✅ |
| 创建文章 | ✅ | ✅ | ✅ | ❌ |
| 编辑自己的文章 | ✅（审核前） | ✅ | ✅ | ❌ |
| 删除自己的文章 | ✅ | ✅ | ✅ | ❌ |
| 删除他人文章 | ❌ | ❌ | ✅ | ❌ |
| 直接发布文章 | ❌ | ✅ | ✅ | ❌ |
| 审核文章 | ❌ | ❌ | ✅ | ❌ |
| 管理分类 | ❌ | ❌ | ✅ | ❌ |
| 点赞文章 | ✅ | ✅ | ✅ | ❌ |
| 评论文章 | ✅ | ✅ | ✅ | ❌ |
| 收藏文章 | ✅ | ✅ | ✅ | ❌ |

---

## 使用指南

### 学生发布文章流程

1. 点击导航栏"博客"
2. 点击"写文章"按钮
3. 填写标题、选择分类、添加标签
4. 编写Markdown内容（实时预览）
5. 点击"保存草稿"（可多次编辑）
6. 点击"提交审核"
7. 等待管理员审核
8. 收到审核结果通知

### 教师发布文章流程

1. 点击导航栏"博客"
2. 点击"写文章"按钮
3. 填写标题、选择分类、添加标签
4. 编写Markdown内容
5. 点击"发布文章"（直接发布，带教师标识）

### 管理员审核流程

1. 导航栏"博客" → "审核管理"（或直接访问 `/blog/review`）
2. 查看待审核文章列表
3. 点击文章查看详情
4. 预览文章内容
5. 点击"通过"或"拒绝"（需填写拒绝原因）
6. 系统自动通知作者

### 管理员创建分类

1. 导航栏"博客" → "分类管理"（或直接访问 `/blog/manage`）
2. 点击"新建分类"
3. 填写分类名称和描述
4. 保存

---

## 特色功能

### 1. 实时预览编辑器
- 左侧Markdown编辑，右侧实时预览
- 工具栏支持快捷操作（加粗、斜体、代码、链接等）
- 字符计数显示，防止超限

### 2. 代码高亮
- 支持C++、Python、Java等多种语言
- 使用VSCode Dark+主题
- 代码块清晰美观

### 3. 两级评论系统
- 评论文章（一级评论）
- 回复评论（二级评论）
- 评论时间展示
- 支持emoji表情

### 4. 智能通知
- 文章审核通过通知
- 文章审核拒绝通知（含原因）
- 收到评论通知
- 集成现有通知中心

### 5. 文章标识
- **官方标识**：管理员发布的文章显示红色"官方"徽章
- **教师标识**：教师发布的文章显示绿色"教师"徽章
- 有助于用户识别权威内容

### 6. 几何头像
- 基于用户名自动生成彩色几何图形
- 每个用户有独特的颜色和形状
- 无需上传，自动生成

### 7. 相关推荐
- 文章详情页底部推荐相关文章
- 基于相同分类推荐
- 帮助用户发现更多内容

### 8. 响应式设计
- 桌面端完整体验
- 移动端自适应布局
- 编辑器移动端单栏显示

---

## 界面预览

### 博客首页
```
┌─────────────────────────────────────────────────┐
│  OI教学系统 > 博客                    [写文章]    │
├─────────────────────────────────────────────────┤
│  [搜索框：搜索文章...]                           │
│  [全部] [学习笔记] [解题思路] [经验分享] ...     │
├──────────────────────────┬──────────────────────┤
│ 文章列表（主内容区）      │  侧边栏               │
│ ┌──────────────────────┐ │ 📈 热门文章           │
│ │ [官方] 算法竞赛入门   │ │ 1. XXX               │
│ │ 作者 | 2024-01-26    │ │ 2. XXX               │
│ │ 👁100 ❤50 💬20       │ │ 3. XXX               │
│ └──────────────────────┘ │                       │
└──────────────────────────┴──────────────────────┘
```

### 文章编辑器
```
┌─────────────────────────────────────────────────┐
│  创建新文章                                      │
├─────────────────────────────────────────────────┤
│  标题：[____________________] (0/100)            │
│  分类：[选择分类 ▼]  标签：[输入标签] [添加]    │
├────────────────────┬────────────────────────────┤
│  Markdown 编辑区   │  实时预览区                 │
│  # 标题            │  标题                       │
│  正文...           │  正文...                    │
│  ```cpp            │  ```cpp                     │
│  代码              │  代码（高亮）               │
│  ```               │  ```                        │
├────────────────────┴────────────────────────────┤
│  [保存草稿] [发布文章/提交审核] [取消]           │
└─────────────────────────────────────────────────┘
```

### 文章详情页
```
┌─────────────────────────────────────────────────┐
│  [官方] [算法竞赛]                               │
│  如何高效学习算法                                │
│  👤 张老师 | 📅 2024-01-26 | 👁 100 阅读         │
│  🏷️ 算法 动态规划 学习方法                       │
├─────────────────────────────────────────────────┤
│  文章内容（Markdown渲染）                        │
│  代码块（语法高亮）                              │
├─────────────────────────────────────────────────┤
│  ❤️ 50点赞 | 🔖 20收藏 | 📤 分享                 │
├─────────────────────────────────────────────────┤
│  💬 评论 (10)                                   │
│  ┌───────────────────────────────────────────┐ │
│  │ 用户A: 写得很好！                         │ │
│  │   └─ 作者: 谢谢！                        │ │
│  └───────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

---

## 技术亮点

### 1. 内容校验
- 前端：字符计数实时显示
- 后端：class-validator严格校验
- 双重保护防止超限

### 2. 自动保存
- 每30秒自动保存草稿
- 防止意外关闭页面导致内容丢失
- 保存状态实时反馈

### 3. 权限控制
- 基于角色的访问控制（RBAC）
- 教师和管理员自动发布
- 学生需要审核

### 4. 通知集成
- 复用现有通知系统
- 新增3种通知类型
- 站内通知实时推送

### 5. 性能优化
- 文章列表分页加载
- 热门文章缓存
- 代码高亮异步加载

---

## 部署状态

### 前端
- ✅ 已构建
- ✅ 已部署到Nginx容器
- ✅ 访问地址：http://localhost

### 后端
- ✅ 已构建
- ✅ 已部署到Node容器
- ✅ API地址：http://localhost:3000
- ✅ 所有博客路由已注册

### 数据库
- ✅ 6张新表已创建
- ✅ User表已扩展（avatar, nickname, bio）
- ✅ 通知类型已更新

---

## 待完善功能

### 建议后续添加
- [ ] 文章目录（TOC）自动生成
- [ ] 文章封面图上传
- [ ] 关注作者功能
- [ ] 文章排行榜
- [ ] 文章导出PDF
- [ ] 代码块复制按钮
- [ ] 评论emoji选择器优化
- [ ] 图片上传（插入到文章中）
- [ ] 文章草稿多版本
- [ ] 文章编辑历史

---

## 初始化步骤

### 1. 创建初始分类（管理员）
使用管理员账号登录，访问 `/blog/manage`，创建以下分类：
- 学习笔记
- 解题思路
- 经验分享
- 竞赛动态
- 技术教程

### 2. 测试文章发布
- 学生账号：测试审核流程
- 教师账号：测试直接发布
- 管理员账号：测试官方标识

### 3. 测试评论功能
- 发表评论
- 回复评论
- 接收通知

---

## 注意事项

1. **内容限制**
   - 标题最多100字符
   - 内容最多5000字符
   - 超限会在前端和后端都拦截

2. **评论纯文本**
   - 评论不支持Markdown
   - 只支持纯文本和emoji
   - 防止恶意代码

3. **阅读量统计**
   - 每次访问都会增加阅读量
   - 可后续优化为24小时内同一用户只计数一次

4. **审核通知**
   - 审核结果会通过站内通知推送
   - 用户可在通知中心查看

---

## 快速测试

### 测试账号（如果存在）
- 管理员：admin / password（请根据实际修改）
- 教师：teacher01 / pwd123
- 学生：student01 / pwd123

### 测试步骤

1. **学生测试**
   - 登录学生账号
   - 创建文章 → 提交审核
   - 等待审核通知

2. **管理员测试**
   - 登录管理员账号
   - 进入审核页面
   - 审核学生文章
   - 创建分类
   - 发布官方文章

3. **教师测试**
   - 登录教师账号
   - 创建文章 → 直接发布
   - 查看教师标识

4. **互动测试**
   - 浏览文章
   - 点赞、收藏
   - 发表评论、回复评论

---

## 总结

博客系统已完整集成到OI教学系统中，包含：

✅ **完整的文章创作流程**（编辑、保存、发布）  
✅ **严格的审核机制**（学生审核、教师直发）  
✅ **丰富的互动功能**（评论、点赞、收藏、分享）  
✅ **智能通知推送**（审核结果、新评论）  
✅ **权限控制体系**（基于角色）  
✅ **现代化UI设计**（响应式、Markdown、代码高亮）  

系统已部署上线，可以开始使用！

---

**文档生成时间**：2026年1月26日  
**系统版本**：V1.1.0  
**部署状态**：✅ 已上线运行  
**访问地址**：http://localhost
